<!DOCTYPE html>
<html>
<head>
  <title>Control Page</title>
</head>
<body>
<h2>Control Discord Messages</h2>

<label>
  <input type="checkbox" id="allowSwitch"> Allow Sending
</label>
<br>
<label>
  Cooldown (seconds): <input type="number" id="cooldownInput" value="0" min="0">
</label>
<br>
<button onclick="saveSettings()">Save</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-database-compat.js"></script>

<script>
  // --- FIREBASE CONFIG ---
  const firebaseConfig = {
    apiKey: "AIzaSyA2HyO5wSmAZPBjfFrShcS2EF1G9uFT9nk",
    authDomain: "feindserver-ee38e.firebaseapp.com",
    databaseURL: "https://feindserver-ee38e-default-rtdb.firebaseio.com",
    projectId: "feindserver-ee38e",
    storageBucket: "feindserver-ee38e.appspot.com",
    messagingSenderId: "612147980631",
    appId: "1:612147980631:web:699fec3b5ffa01d0ebb612"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let previousSettings = {};

  // Load current settings from Firebase
  db.ref('control').on('value', snapshot => {
    const data = snapshot.val() || {};
    previousSettings = {
      allowMessages: data.allowMessages !== false,
      cooldown: Math.floor((data.cooldown || 0) / 1000)
    };
    document.getElementById('allowSwitch').checked = previousSettings.allowMessages;
    document.getElementById('cooldownInput').value = previousSettings.cooldown;
  });

  async function saveSettings() {
    const allow = document.getElementById('allowSwitch').checked;
    const cooldown = parseInt(document.getElementById('cooldownInput').value) || 0;

    const changes = [];
    if (allow !== previousSettings.allowMessages) changes.push(`Allow Sending → **${allow}**`);
    if (cooldown !== previousSettings.cooldown) changes.push(`Cooldown → **${cooldown} seconds**`);

    if (changes.length > 0) {
      // Send embed to Discord
      const webhookURL = "https://discord.com/api/webhooks/1462604278462939351/77_Xwp8KgaZlus_T0PMbqmUIhgPG41G1w5YYzXZ8XR6cdAIiKvFT3zdyBtuEP-VNGnyx";
      const embed = {
        title: "Settings Updated",
        description: changes.join("\n"),
        color: 0x00ff00, // green color
        timestamp: new Date()
      };

      try {
        const res = await fetch(webhookURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ embeds: [embed] })
        });
        if (!res.ok) throw new Error(`Discord returned status ${res.status}`);
      } catch(err) {
        console.error("Failed to send Discord message:", err);
      }
    }

    // Save to Firebase
    db.ref('control').set({
      allowMessages: allow,
      cooldown: cooldown * 1000 // convert to milliseconds
    });

    alert('Settings saved!');
  }
</script>
</body>
</html>
